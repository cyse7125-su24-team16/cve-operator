# cve-operator
# GitHub Releases Monitor Operator

## Overview

The GitHub Releases Monitor Operator is a Kubernetes operator that monitors GitHub repositories for new releases and processes specific assets from those releases. It is designed to work with the following Custom Resource Definitions (CRDs):

- **GitHubReleasesMonitor**: Monitors a GitHub repository for new releases.
- **GitHubRelease**: Processes specific assets from the monitored releases.

## Features

### GitHubReleasesMonitor CRD

The `GitHubReleasesMonitor` CRD allows you to configure the operator to monitor a specific GitHub repository for new releases. 

#### CRD Fields

- **url**: The URL of the GitHub repository to monitor releases from. Example: `https://github.com/CVEProject/cvelistV5/releases`.
- **monitorFrom**: Specifies the starting point for monitoring releases. It can take two values:
  - **now**: The operator monitors releases from the time the CRD was created.
  - **date**: The operator processes all releases from the specified date onwards.

#### Controller Behavior

- The controller creates a `GitHubRelease` CR for each new release found. If a `GitHubRelease` CR already exists for a release, it will be ignored.
- The `GitHubRelease` CRs will have finalizers set on them to ensure proper cleanup.
- The status of the `GitHubReleasesMonitor` CRD will include:
  - A list of releases found on the GitHub repository.
  - The time (in UTC) when the releases were retrieved.
  - The value of `monitorFrom` in the form of a timestamp (in UTC).

### GitHubRelease CRD

The `GitHubRelease` CRD is responsible for processing specific assets from the monitored GitHub releases.

#### CRD Fields

- **url**: The URL of the GitHub release asset to download.

#### Controller Behavior

- The controller downloads the asset with the name "delta" in it from the specified release.
- A Kubernetes `Job` is created to process the asset. The URL for the "delta" zip file is passed as a parameter to the `Job`.
- If the `Job` fails, it will be retried until it succeeds.
- Once the `Job` succeeds, it will not be relaunched for that `GitHubRelease` CRD.
- If the `GitHubRelease` CR is deleted, the controller for `GitHubReleasesMonitor` will re-create it, and the `Job` will run again.

## Installation

To install the GitHub Releases Monitor Operator, apply the necessary CRDs and deploy the operator using the provided manifests.

```bash
kubectl apply -f crds/githubreleasesmonitor-crd.yaml
kubectl apply -f crds/githubrelease-crd.yaml
kubectl apply -f deploy/operator.yaml
```

## Usage

1. **Create a GitHubReleasesMonitor CRD**: 

```yaml
apiVersion: monitoring.example.com/v1
kind: GitHubReleasesMonitor
metadata:
  name: cve-releases-monitor
spec:
  url: https://github.com/CVEProject/cvelistV5/releases
  monitorFrom: now
```

This will start monitoring the specified GitHub repository for new releases from the time the CRD was created.

2. **GitHubRelease CRD Handling**:

The operator will automatically create `GitHubRelease` CRs for new releases found. These CRs will trigger the processing of assets with "delta" in their name.

## CRD Status Example

The status of the `GitHubReleasesMonitor` CRD may look like the following:

```yaml
status:
  releases:
    - release1
    - release2
  lastChecked: "2024-08-09T14:55:00Z"
  monitorFromTimestamp: "2024-08-08T19:00:00Z"
```

This status indicates that the operator found two releases (`release1` and `release2`) and last checked for new releases at the specified UTC time.
